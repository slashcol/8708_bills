(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{e7MO:function(t,i,n){"use strict";n.r(i),n.d(i,"CheckoutPageModule",(function(){return et}));var e=n("tyNb"),o=n("mrSG"),s=n("3Pt+"),c=n("NV1z"),r=n("Xjug"),a=n("dNOa"),l=n("jgsO"),b=n("X0/9"),d=n("Obz0"),h=n("gNTI"),m=n("RKXm"),u=n("s5X5"),g=n("T0Z2"),p=n("GvuD"),C=n("fXoL"),f=n("TEn/"),U=n("ofXK"),O=n("4ro/"),V=n("oZYh"),w=n("xJkR"),E=n("sYmb");function v(t,i){1&t&&(C.Qb(0,"empty-view",7),C.hc(1,"translate")),2&t&&C.mc("text",C.ic(1,1,"ERROR_DATA"))}function T(t,i){1&t&&(C.Qb(0,"empty-view",8),C.hc(1,"translate")),2&t&&C.mc("text",C.ic(1,1,"CART_EMPTY"))}const _=function(t){return{value:t}};function y(t,i){if(1&t&&(C.Vb(0,"div",44),C.Fc(1),C.hc(2,"translate"),C.hc(3,"currencyGlobal"),C.Ub()),2&t){const t=C.gc(3);C.Cb(1),C.Hc(" ",C.jc(2,1,"ERROR_MINIMUM_ORDER_AMOUNT",C.qc(6,_,C.ic(3,4,t.minimumOrderAmount)))," ")}}function I(t,i){if(1&t&&(C.Vb(0,"div",44),C.Fc(1),C.hc(2,"translate"),C.hc(3,"currencyGlobal"),C.Ub()),2&t){const t=C.gc(3);C.Cb(1),C.Hc(" ",C.jc(2,1,"ERROR_MAXIMUM_ORDER_AMOUNT",C.qc(6,_,C.ic(3,4,t.maximumOrderAmount)))," ")}}function A(t,i){1&t&&(C.Vb(0,"p",45),C.Fc(1),C.hc(2,"translate"),C.Ub()),2&t&&(C.Cb(1),C.Hc(" ",C.ic(2,1,"PAYMENT_METHOD_NOT_FOUND")," "))}function R(t,i){1&t&&(C.Vb(0,"ion-item"),C.Vb(1,"ion-label"),C.Vb(2,"p"),C.Fc(3),C.hc(4,"translate"),C.Ub(),C.Ub(),C.Qb(5,"ion-radio",46),C.Ub()),2&t&&(C.Cb(3),C.Gc(C.ic(4,1,"CASH")))}function D(t,i){1&t&&(C.Vb(0,"ion-item",47),C.Vb(1,"ion-label"),C.Vb(2,"p"),C.Fc(3),C.hc(4,"translate"),C.Ub(),C.Ub(),C.Qb(5,"ion-radio",48),C.Ub()),2&t&&(C.Cb(3),C.Gc(C.ic(4,1,"CREDIT_DEBIT_CARD")))}function P(t,i){if(1&t&&(C.Vb(0,"ion-item"),C.Vb(1,"ion-label",49),C.Fc(2," \xa0\xa0\xa0\xa0"),C.Qb(3,"img",50),C.Fc(4," \xa0\xa0"),C.Qb(5,"span",51),C.Ub(),C.Qb(6,"ion-radio",52),C.Ub()),2&t){const t=i.$implicit;C.Cb(3),C.oc("src","./assets/imgs/",t.formatBrand(),".png",C.zc),C.Cb(2),C.mc("innerHTML",t,C.xc),C.Cb(1),C.mc("value",t)}}function M(t,i){if(1&t&&(C.Vb(0,"ion-item"),C.Vb(1,"ion-label"),C.Vb(2,"p"),C.Vb(3,"ion-text",53),C.Fc(4),C.Ub(),C.Ub(),C.Vb(5,"p",54),C.Fc(6),C.hc(7,"translate"),C.Ub(),C.Ub(),C.Qb(8,"ion-radio",52),C.Ub()),2&t){const t=i.$implicit;C.Cb(4),C.Hc(" ",t," "),C.Cb(2),C.Ic(" ",C.ic(7,4,"CONTACT_PHONE"),": ",t.phone," "),C.Cb(2),C.mc("value",t)}}function N(t,i){if(1&t&&(C.Vb(0,"ion-thumbnail",2),C.Qb(1,"img",62),C.Ub()),2&t){const t=C.gc().$implicit;C.Cb(1),C.mc("src",null==t.featuredImageThumb?null:t.featuredImageThumb.url(),C.zc)}}function F(t,i){if(1&t&&(C.Vb(0,"p"),C.Vb(1,"span",63),C.Fc(2),C.hc(3,"translate"),C.Ub(),C.Fc(4),C.Ub()),2&t){const t=C.gc().$implicit;C.Cb(2),C.Hc("",C.ic(3,2,"VARIANT"),":"),C.Cb(2),C.Hc(" ",t.variation.name," ")}}function x(t,i){if(1&t&&(C.Vb(0,"span"),C.Vb(1,"ion-text",64),C.Vb(2,"s",54),C.Fc(3),C.hc(4,"currencyGlobal"),C.Ub(),C.Ub(),C.Qb(5,"br"),C.Vb(6,"span"),C.Fc(7),C.hc(8,"currencyGlobal"),C.Ub(),C.Ub()),2&t){const t=C.gc(2).$implicit;C.Cb(3),C.Hc(" ",C.ic(4,2,t.amount)," "),C.Cb(4),C.Hc(" ",C.ic(8,4,t.finalAmount)," ")}}function G(t,i){if(1&t&&(C.Vb(0,"span"),C.Vb(1,"span"),C.Fc(2),C.hc(3,"currencyGlobal"),C.Ub(),C.Ub()),2&t){const t=C.gc(2).$implicit;C.Cb(2),C.Gc(C.ic(3,1,t.finalAmount))}}function H(t,i){if(1&t&&(C.Vb(0,"p",34),C.Dc(1,x,9,6,"span",11),C.Dc(2,G,4,3,"span",11),C.Ub()),2&t){const t=C.gc().$implicit;C.Cb(1),C.mc("ngIf",t.amount>t.finalAmount),C.Cb(1),C.mc("ngIf",t.amount<=t.finalAmount)}}function L(t,i){if(1&t&&(C.Vb(0,"p",34),C.Fc(1),C.hc(2,"currencyGlobal"),C.Ub()),2&t){const t=C.gc().$implicit;C.Cb(1),C.Hc(" ",C.ic(2,1,t.amount)," ")}}function S(t,i){if(1&t&&(C.Vb(0,"ion-item",55),C.Dc(1,N,2,1,"ion-thumbnail",56),C.Vb(2,"ion-row",57),C.Vb(3,"ion-col"),C.Vb(4,"ion-label"),C.Vb(5,"p",58),C.Fc(6),C.Ub(),C.Dc(7,F,5,4,"p",11),C.Ub(),C.Ub(),C.Ub(),C.Vb(8,"div",59),C.Dc(9,H,3,2,"p",60),C.Dc(10,L,3,3,"ng-template",null,61,C.Ec),C.Ub(),C.Ub()),2&t){const t=i.$implicit,n=i.last,e=C.uc(11);C.mc("lines",n?"none":"full"),C.Cb(1),C.mc("ngIf",t.featuredImageThumb),C.Cb(5),C.Ic(" ",t.qty," x ",t.name," "),C.Cb(1),C.mc("ngIf",t.variation),C.Cb(2),C.mc("ngIf",t.hasOwnProperty("finalAmount"))("ngIfElse",e)}}function k(t,i){if(1&t){const t=C.Wb();C.Vb(0,"ion-item",65),C.Vb(1,"ion-label"),C.Fc(2),C.hc(3,"translate"),C.Ub(),C.Vb(4,"ion-button",66),C.dc("click",(function(){return C.wc(t),C.gc(3).onRemoveCoupon()})),C.Vb(5,"span",67),C.Fc(6),C.hc(7,"translate"),C.Ub(),C.Ub(),C.Ub()}if(2&t){const t=C.gc(3);C.Fb("opacity-medium",t.isUpdatingCart),C.Cb(2),C.Ic(" ",C.ic(3,6,"COUPON"),": ",null==t.cart||null==t.cart.coupon?null:t.cart.coupon.name," "),C.Cb(2),C.mc("disabled",t.isUpdatingCart||t.isCreatingOrder),C.Cb(2),C.Hc(" ",C.ic(7,8,"REMOVE_COUPON")," ")}}function Q(t,i){if(1&t&&(C.Vb(0,"p"),C.Fc(1),C.hc(2,"translate"),C.Ub()),2&t){const t=C.gc(3);C.Cb(1),C.Ic(" ",C.ic(2,2,"COUPON_DISCOUNT")," (",null==t.cart||null==t.cart.coupon?null:t.cart.coupon.name,") ")}}function z(t,i){if(1&t&&(C.Vb(0,"p"),C.Fc(1),C.hc(2,"currencyGlobal"),C.Ub()),2&t){const t=C.gc(3);C.Cb(1),C.Hc(" ",C.ic(2,1,0-(null==t.cart||null==t.cart.coupon?null:t.cart.coupon.amount))," ")}}function j(t,i){1&t&&C.Qb(0,"ion-spinner",65)}function K(t,i){1&t&&(C.Vb(0,"span"),C.Fc(1),C.hc(2,"translate"),C.Ub()),2&t&&(C.Cb(1),C.Gc(C.ic(2,1,"PLACE_ORDER")))}function W(t,i){if(1&t){const t=C.Wb();C.Vb(0,"ion-row"),C.Vb(1,"ion-col",12),C.Dc(2,y,4,8,"div",13),C.Dc(3,I,4,8,"div",13),C.Vb(4,"ion-item-group",14),C.Vb(5,"ion-list-header",15),C.Vb(6,"h5"),C.Fc(7),C.hc(8,"translate"),C.Ub(),C.Ub(),C.Vb(9,"ion-item",16),C.Qb(10,"ion-input",17),C.hc(11,"translate"),C.Ub(),C.Ub(),C.Vb(12,"ion-item-group",14),C.Vb(13,"ion-list-header",15),C.Vb(14,"h5"),C.Fc(15),C.hc(16,"translate"),C.Ub(),C.Ub(),C.Vb(17,"ion-list",18),C.Dc(18,A,3,3,"p",19),C.Vb(19,"ion-radio-group",20),C.dc("ionChange",(function(i){return C.wc(t),C.gc(2).onChangePaymentMethod(i)})),C.Dc(20,R,6,3,"ion-item",11),C.Dc(21,D,6,3,"ion-item",21),C.Ub(),C.Ub(),C.Vb(22,"ion-list",22),C.Vb(23,"ion-radio-group",23),C.Dc(24,P,7,3,"ion-item",24),C.Vb(25,"ion-item"),C.Vb(26,"ion-button",25),C.dc("click",(function(){return C.wc(t),C.gc(2).onPresentCardAddModal()})),C.Fc(27),C.hc(28,"translate"),C.Ub(),C.Ub(),C.Ub(),C.Ub(),C.Ub(),C.Vb(29,"ion-list-header",15),C.Vb(30,"h5"),C.Fc(31),C.hc(32,"translate"),C.Ub(),C.Ub(),C.Vb(33,"ion-list",26),C.Vb(34,"ion-radio-group",27),C.dc("ionChange",(function(){return C.wc(t),C.gc(2).onChangeAddress()})),C.Dc(35,M,9,6,"ion-item",24),C.Vb(36,"ion-item"),C.Vb(37,"ion-button",25),C.dc("click",(function(){return C.wc(t),C.gc(2).onPresentAddressAddModal()})),C.Fc(38),C.hc(39,"translate"),C.Ub(),C.Ub(),C.Ub(),C.Ub(),C.Ub(),C.Vb(40,"ion-col",28),C.Vb(41,"ion-list-header",29),C.Vb(42,"h5"),C.Fc(43),C.hc(44,"translate"),C.Ub(),C.Ub(),C.Vb(45,"div",30),C.Vb(46,"ion-item-group",14),C.Dc(47,S,12,7,"ion-item",31),C.Ub(),C.Vb(48,"ion-list-header"),C.Vb(49,"ion-label"),C.Vb(50,"h5"),C.Fc(51),C.hc(52,"translate"),C.Ub(),C.Ub(),C.Ub(),C.Vb(53,"ion-item",16),C.Qb(54,"ion-input",32),C.hc(55,"translate"),C.Ub(),C.Vb(56,"ion-button",33),C.dc("click",(function(){return C.wc(t),C.gc(2).onApplyCouponButtonTouched()})),C.Vb(57,"span",34),C.Fc(58),C.hc(59,"translate"),C.Ub(),C.Ub(),C.Dc(60,k,8,10,"ion-item",35),C.Vb(61,"ion-row"),C.Vb(62,"ion-col",36),C.Vb(63,"p"),C.Fc(64),C.hc(65,"translate"),C.Ub(),C.Dc(66,Q,3,4,"p",11),C.Vb(67,"p"),C.Fc(68),C.hc(69,"translate"),C.Ub(),C.Vb(70,"p"),C.Fc(71),C.hc(72,"translate"),C.Ub(),C.Ub(),C.Vb(73,"ion-col",37),C.Vb(74,"p"),C.Fc(75),C.hc(76,"currencyGlobal"),C.Ub(),C.Dc(77,z,3,3,"p",11),C.Vb(78,"p"),C.Fc(79),C.hc(80,"currencyGlobal"),C.Ub(),C.Vb(81,"p"),C.Fc(82),C.hc(83,"currencyGlobal"),C.Ub(),C.Ub(),C.Ub(),C.Vb(84,"div",38),C.Vb(85,"ion-button",39),C.Dc(86,j,1,0,"ion-spinner",40),C.Dc(87,K,3,3,"span",11),C.Ub(),C.Vb(88,"p"),C.Vb(89,"small"),C.Fc(90),C.hc(91,"translate"),C.Ub(),C.Ub(),C.Qb(92,"img",41),C.Qb(93,"img",42),C.Qb(94,"img",43),C.Ub(),C.Ub(),C.Ub(),C.Ub()}if(2&t){const t=C.gc(2);C.Cb(2),C.mc("ngIf",t.minimumOrderAmount&&(null==t.cart?null:t.cart.subtotal)<t.minimumOrderAmount),C.Cb(1),C.mc("ngIf",t.maximumOrderAmount&&(null==t.cart?null:t.cart.subtotal)>t.maximumOrderAmount),C.Cb(4),C.Gc(C.ic(8,35,"CONTACT_INFO")),C.Cb(3),C.mc("placeholder",C.ic(11,37,"CONTACT_EMAIL")),C.Cb(5),C.Gc(C.ic(16,39,"PAYMENT")),C.Cb(3),C.mc("ngIf",!t.isCardEnabled&&!t.isCodEnabled),C.Cb(2),C.mc("ngIf",t.isCodEnabled),C.Cb(1),C.mc("ngIf",t.isCardEnabled),C.Cb(1),C.mc("hidden","Card"!==t.paymentMethodField.value),C.Cb(2),C.mc("ngForOf",t.cards),C.Cb(3),C.Hc(" ",C.ic(28,41,"ADD_CARD")," "),C.Cb(4),C.Gc(C.ic(32,43,"SHIPPING")),C.Cb(4),C.mc("ngForOf",t.addresses),C.Cb(3),C.Hc(" ",C.ic(39,45,"ADD_NEW_ADDRESS")," "),C.Cb(5),C.Gc(C.ic(44,47,"ORDER_SUMMARY")),C.Cb(4),C.mc("ngForOf",null==t.cart?null:t.cart.items),C.Cb(4),C.Gc(C.ic(52,49,"COUPON")),C.Cb(3),C.mc("placeholder",C.ic(55,51,"COUPON_PLACEHOLDER")),C.Cb(2),C.mc("disabled",t.isUpdatingCart||t.isCreatingOrder),C.Cb(2),C.Gc(C.ic(59,53,"APPLY_COUPON")),C.Cb(2),C.mc("ngIf",null==t.cart?null:t.cart.coupon),C.Cb(1),C.Fb("opacity-medium",t.isUpdatingCart),C.Cb(3),C.Gc(C.ic(65,55,"SUBTOTAL")),C.Cb(2),C.mc("ngIf",null==t.cart?null:t.cart.coupon),C.Cb(2),C.Gc(C.ic(69,57,"SHIPPING_FEE")),C.Cb(3),C.Gc(C.ic(72,59,"TOTAL")),C.Cb(4),C.Gc(C.ic(76,61,null==t.cart?null:t.cart.subtotal)),C.Cb(2),C.mc("ngIf",null==t.cart?null:t.cart.coupon),C.Cb(2),C.Gc(C.ic(80,63,null==t.cart?null:t.cart.shippingFee)),C.Cb(3),C.Gc(C.ic(83,65,null==t.cart?null:t.cart.total)),C.Cb(3),C.mc("disabled",t.isUpdatingCart||t.isCreatingOrder),C.Cb(1),C.mc("ngIf",t.isCreatingOrder),C.Cb(1),C.mc("ngIf",!t.isCreatingOrder),C.Cb(3),C.Gc(C.ic(91,67,"TRANSACTION_NOTICE"))}}function q(t,i){if(1&t){const t=C.Wb();C.Vb(0,"form",9,10),C.dc("ngSubmit",(function(){return C.wc(t),C.gc().onPlaceOrder()})),C.Dc(2,W,95,69,"ion-row",11),C.Ub()}if(2&t){const t=C.gc();C.mc("formGroup",t.form),C.Cb(2),C.mc("ngIf",t.isContentViewVisible)}}const Y=function(){return{"border-radius":"0",height:"120px",width:"100%"}},B=function(){return{"border-radius":"0",height:"240px",width:"100%"}},X=function(){return{"border-radius":"0",height:"270px",width:"100%"}};function $(t,i){1&t&&(C.Vb(0,"ion-row",68),C.Vb(1,"ion-col",69),C.Qb(2,"ngx-skeleton-loader",70),C.Qb(3,"ngx-skeleton-loader",70),C.Qb(4,"ngx-skeleton-loader",70),C.Ub(),C.Vb(5,"ion-col",71),C.Qb(6,"ngx-skeleton-loader",70),C.Ub(),C.Ub()),2&t&&(C.Cb(2),C.mc("theme",C.pc(4,Y)),C.Cb(1),C.mc("theme",C.pc(5,Y)),C.Cb(1),C.mc("theme",C.pc(6,B)),C.Cb(2),C.mc("theme",C.pc(7,X)))}let J=(()=>{class t extends c.a{constructor(t,i,n,e,o,s){super(t),this.cardService=i,this.cartService=n,this.appConfig=e,this.currencyGlobalPipe=o,this.customerAddressService=s,this.addresses=[],this.cards=[]}get shippingField(){return this.form.get("shipping")}get paymentMethodField(){return this.form.get("paymentMethod")}get contactEmailField(){return this.form.get("contactEmail")}get cardField(){return this.form.get("card")}ngOnInit(){this.setupForm()}enableMenuSwipe(){return!1}setupEvents(){this.loginListener=()=>this.onPlaceOrder(),document.addEventListener("user:login",this.loginListener)}setupForm(){const t=l.a.getCurrent(),i=t.attributes.email||t.attributes.contactEmail;this.form=new s.c({shipping:new s.a(null,s.m.required),contactEmail:new s.a(i,[s.m.required,s.m.email]),card:new s.a(null),paymentMethod:new s.a("",s.m.required),couponCode:new s.a("")})}ionViewDidEnter(){return Object(o.a)(this,void 0,void 0,(function*(){this.setupEvents(),l.a.getCurrent()?(this.showLoadingView({showOverlay:!1}),this.loadCart()):this.showEmptyView();const t=yield this.getTrans("CHECKOUT");this.setPageTitle(t),this.setMetaTags({title:t})}))}ionViewDidLeave(){document.removeEventListener("user:login",this.loginListener)}onRemoveCoupon(){return Object(o.a)(this,void 0,void 0,(function*(){try{this.isUpdatingCart=!0;const t=yield this.cart.removeCoupon();this.cart=t,this.isUpdatingCart=!1,this.translate.get("COUPON_REMOVED").subscribe(t=>this.showToast(t))}catch(t){this.isUpdatingCart=!1,this.translate.get("ERROR_NETWORK").subscribe(t=>this.showToast(t))}}))}onApplyCouponButtonTouched(){return Object(o.a)(this,void 0,void 0,(function*(){const t=(this.form.value.couponCode||"").trim();if(t)try{this.isUpdatingCart=!0;const i=yield this.cart.applyCoupon(t);this.cart=i,this.isUpdatingCart=!1,this.translate.get("COUPON_CODE_APPLIED").subscribe(t=>this.showToast(t))}catch(i){this.isUpdatingCart=!1,this.showCouponErrorsIfNeeded(i)}}))}showCouponErrorsIfNeeded(t){if(5e3===t.code)this.translate.get("COUPON_NOT_FOUND").subscribe(t=>this.showToast(t));else if(5001===t.code)this.translate.get("COUPON_INACTIVE").subscribe(t=>this.showToast(t));else if(5002===t.code)this.translate.get("COUPON_USAGE_LIMIT_REACHED").subscribe(t=>this.showToast(t));else if(5003===t.code)this.translate.get("COUPON_NOT_STARTED_YET").subscribe(t=>this.showToast(t));else if(5004===t.code)this.translate.get("COUPON_EXPIRED").subscribe(t=>this.showToast(t));else if(5005===t.code)this.translate.get("COUPON_USAGE_LIMIT_PER_USER_REACHED").subscribe(t=>this.showToast(t));else if(5006===t.code){const i=t.message.match(/\%(.*?)\%/);if(i){const t=this.currencyGlobalPipe.transform(i[1]);this.translate.get("ERROR_MINIMUM_AMOUNT_COUPON",{value:t}).subscribe(t=>this.showToast(t))}}else if(5007===t.code){const i=t.message.match(/\%(.*?)\%/);if(i){const t=this.currencyGlobalPipe.transform(i[1]);this.translate.get("ERROR_MAXIMUM_AMOUNT_COUPON",{value:t}).subscribe(t=>this.showToast(t))}}else 5008===t.code||5009===t.code||5010===t.code||5011===t.code||5012===t.code||5013===t.code||5014===t.code||5015===t.code||5016===t.code?this.translate.get("CANNOT_APPLY_COUPON").subscribe(t=>this.showToast(t)):this.translate.get("ERROR_NETWORK").subscribe(t=>this.showToast(t))}loadCart(){var t,i,n,e;return Object(o.a)(this,void 0,void 0,(function*(){try{const o=yield this.appConfig.load();if(this.isCardEnabled=null===(t=o.admin)||void 0===t?void 0:t.isCardEnabled,this.isCodEnabled=null===(i=o.admin)||void 0===i?void 0:i.isCodEnabled,this.minimumOrderAmount=null===(n=o.admin)||void 0===n?void 0:n.minimumOrderAmount,this.maximumOrderAmount=null===(e=o.admin)||void 0===e?void 0:e.maximumOrderAmount,this.cart=yield this.cartService.getOne(),this.cart&&"expired"===this.cart.status)return window.dispatchEvent(new CustomEvent("cart:expired",{detail:this.cart})),this.goBack();if(this.cart&&!this.cart.empty()){if(this.addresses=yield this.customerAddressService.load(),this.cart.shipping&&this.addresses.length){const t=this.addresses.find(t=>t.id===this.cart.shipping.id);this.form.controls.shipping.setValue(t),this.onChangeAddress()}else this.addresses.length&&(this.form.controls.shipping.setValue(this.addresses[0]),this.onChangeAddress());this.cards=yield this.cardService.load(),this.cards.length&&this.form.controls.card.setValue(this.cards[0]),this.showContentView()}else this.showEmptyView()}catch(o){this.showErrorView(),this.translate.get("ERROR_NETWORK").subscribe(t=>this.showToast(t))}}))}onPresentCardAddModal(){return Object(o.a)(this,void 0,void 0,(function*(){yield this.showLoadingView({showOverlay:!0});const t=yield this.modalCtrl.create({component:g.a});yield t.present(),this.showContentView();const{data:i}=yield t.onWillDismiss();i&&(this.cards=[i,...this.cards],this.form.controls.card.setValue(i))}))}onPresentAddressAddModal(){return Object(o.a)(this,void 0,void 0,(function*(){yield this.showLoadingView({showOverlay:!0});const t=yield this.modalCtrl.create({component:u.a});yield t.present(),this.showContentView();const{data:i}=yield t.onWillDismiss();i&&(this.addresses=[i,...this.addresses],this.form.controls.shipping.setValue(i))}))}onChangeAddress(){return Object(o.a)(this,void 0,void 0,(function*(){try{this.isUpdatingCart=!0,yield this.cart.save({shipping:this.shippingField.value}),this.isUpdatingCart=!1}catch(t){this.isUpdatingCart=!1}}))}onChangePaymentMethod(t={}){const i=t.target.value;"Cash"===i?(this.form.controls.card.clearValidators(),this.form.controls.card.setValue(null),this.form.controls.card.updateValueAndValidity()):"Card"===i&&(this.form.controls.card.setValidators(s.m.required),this.form.controls.card.updateValueAndValidity())}prepareOrderData(){const t=Object.assign({},this.form.value),i=new a.a;return i.paymentMethod=t.paymentMethod,i.card=t.card,i.contact={email:t.contactEmail},i}onPresentSignUpModal(){return Object(o.a)(this,void 0,void 0,(function*(){yield this.showLoadingView({showOverlay:!0});const t=yield this.modalCtrl.create({component:p.a,componentProps:{showSignUpForm:!0}});yield t.present(),this.showContentView()}))}onPlaceOrder(){return Object(o.a)(this,void 0,void 0,(function*(){try{if(this.form.controls.contactEmail.hasError("required")){const t=yield this.getTrans("CHECKOUT_EMAIL_REQUIRED");return this.showToast(t)}if(this.form.controls.contactEmail.hasError("email")){const t=yield this.getTrans("CHECKOUT_EMAIL_INVALID");return this.showToast(t)}if(this.form.controls.shipping.hasError("required")){const t=yield this.getTrans("CHECKOUT_ADDRESS_REQUIRED");return this.showToast(t)}if(this.form.controls.paymentMethod.hasError("required")){const t=yield this.getTrans("CHECKOUT_PAYMENT_METHOD_REQUIRED");return this.showToast(t)}if(this.form.controls.card.hasError("required")){const t=yield this.getTrans("CHECKOUT_CARD_REQUIRED");return this.showToast(t)}if(this.form.invalid)return this.translate.get("INVALID_FORM").subscribe(t=>this.showToast(t));this.isCreatingOrder=!0;const t=this.prepareOrderData();yield t.save(),this.isCreatingOrder=!1,window.dispatchEvent(new CustomEvent("cart:updated",{detail:new r.a})),this.setRelativeRoot("./thanks/"+t.id)}catch(t){if(1001===t.code)this.translate.get("ACCOUNT_BLOCKED").subscribe(t=>this.showToast(t));else if(1002===t.code)this.translate.get("CARD_DECLINED").subscribe(t=>this.showToast(t));else if(1004===t.code){const i=t.message.match(/\%(.*?)\%/);if(i){const t=this.currencyGlobalPipe.transform(i[1]);this.translate.get("ERROR_MINIMUM_ORDER_AMOUNT",{value:t}).subscribe(t=>this.showToast(t))}}else if(1005===t.code){const i=t.message.match(/\%(.*?)\%/);if(i){const t=this.currencyGlobalPipe.transform(i[1]);this.translate.get("ERROR_MAXIMUM_ORDER_AMOUNT",{value:t}).subscribe(t=>this.showToast(t))}}else 1006===t.code?(this.onPresentSignUpModal(),this.translate.get("ERROR_CHECKOUT_GUEST_DISABLED").subscribe(t=>this.showToast(t,"top"))):this.showCouponErrorsIfNeeded(t);this.isCreatingOrder=!1}}))}}return t.\u0275fac=function(i){return new(i||t)(C.Pb(C.r),C.Pb(d.a),C.Pb(r.a),C.Pb(h.a),C.Pb(m.a),C.Pb(b.a))},t.\u0275cmp=C.Jb({type:t,selectors:[["checkout-page"]],features:[C.Bb([m.a]),C.zb],decls:13,vars:7,consts:[[1,"ion-no-border"],["fixed",""],["slot","start"],["icon","alert-circle-outline",3,"text",4,"ngIf"],["image","./assets/imgs/undraw_add_to_cart_vkjp.svg","imageWidth","120",3,"text",4,"ngIf"],["novalidate","",3,"formGroup","ngSubmit",4,"ngIf"],["class","ion-margin",4,"ngIf"],["icon","alert-circle-outline",3,"text"],["image","./assets/imgs/undraw_add_to_cart_vkjp.svg","imageWidth","120",3,"text"],["novalidate","",3,"formGroup","ngSubmit"],["ngForm","ngForm"],[4,"ngIf"],["size-xs","12","size-lg","7"],["class","alert alert-warning",4,"ngIf"],[1,"ion-margin-vertical"],[1,"ion-margin-bottom","bold"],["lines","none",1,"text-medium","item-input","ion-margin-horizontal"],["type","email","formControlName","contactEmail",3,"placeholder"],["lines","none",1,"ion-no-padding","ion-no-margin"],["class","text-medium ion-padding-horizontal ion-no-margin",4,"ngIf"],["mode","md","formControlName","paymentMethod",3,"ionChange"],["lines","none",4,"ngIf"],[3,"hidden"],["mode","md","formControlName","card"],[4,"ngFor","ngForOf"],["strong","","type","button","size","small",1,"ion-text-capitalize",3,"click"],[1,"ion-no-padding"],["mode","md","formControlName","shipping",3,"ionChange"],["size-xs","12","size-lg","5"],[1,"bold","ion-margin-top"],[1,"bg-light","radius","ion-padding","ion-margin-top"],["style","--padding-start:0","color","light",3,"lines",4,"ngFor","ngForOf"],["type","text","formControlName","couponCode",3,"placeholder"],["size","small","color","white",1,"ion-margin","ion-text-capitalize",2,"min-width","140px",3,"disabled","click"],[1,"text-medium"],["color","light",3,"opacity-medium",4,"ngIf"],[1,"ion-text-nowrap"],[1,"ion-text-end"],[1,"ion-text-center"],["type","submit","strong","","shape","round","color","primary",1,"ion-text-uppercase",3,"disabled"],["color","light",4,"ngIf"],["src","./assets/imgs/mastercard.png","width","40"],["src","./assets/imgs/visa.png","width","40"],["src","./assets/imgs/american_express.png","width","40"],[1,"alert","alert-warning"],[1,"text-medium","ion-padding-horizontal","ion-no-margin"],["value","Cash"],["lines","none"],["value","Card"],[1,"flex","align-items-center"],["width","30",3,"src"],[1,"text-medium",3,"innerHTML"],["color","dark",3,"value"],["color","dark"],[1,"text-small"],["color","light",2,"--padding-start","0",3,"lines"],["slot","start",4,"ngIf"],[1,"full-width"],[1,"text-normal","ellipsis","mb-8"],["slot","end"],["class","text-medium",4,"ngIf","ngIfElse"],["showOnlyAmount",""],["src-fallback","./assets/imgs/placeholder.png",3,"src"],[1,"bold"],["color","medium"],["color","light"],["slot","end","fill","clear",3,"disabled","click"],[1,"ion-text-capitalize","text-small"],[1,"ion-margin"],["size-xs","12","size-lg","8"],["count","1",3,"theme"],["size-xs","12","size-lg","4"]],template:function(t,i){1&t&&(C.Vb(0,"ion-header",0),C.Vb(1,"ion-toolbar",1),C.Vb(2,"ion-buttons",2),C.Qb(3,"ion-back-button"),C.Ub(),C.Vb(4,"ion-title"),C.Fc(5),C.hc(6,"translate"),C.Ub(),C.Ub(),C.Ub(),C.Vb(7,"ion-content"),C.Vb(8,"ion-grid",1),C.Dc(9,v,2,3,"empty-view",3),C.Dc(10,T,2,3,"empty-view",4),C.Dc(11,q,3,2,"form",5),C.Dc(12,$,7,8,"ion-row",6),C.Ub(),C.Ub()),2&t&&(C.Cb(5),C.Gc(C.ic(6,5,"CHECKOUT")),C.Cb(4),C.mc("ngIf",i.isErrorViewVisible),C.Cb(1),C.mc("ngIf",i.isEmptyViewVisible),C.Cb(1),C.mc("ngIf",i.isContentViewVisible),C.Cb(1),C.mc("ngIf",i.isLoadingViewVisible))},directives:[f.s,f.Y,f.k,f.g,f.h,f.W,f.p,f.r,U.l,O.a,s.n,s.j,s.d,f.J,f.o,f.y,f.B,f.x,f.w,f.ib,s.i,s.b,f.A,f.D,f.hb,U.k,f.j,f.z,f.C,f.fb,f.T,f.V,V.a,f.P,w.a],pipes:[E.c,m.a],styles:["ion-content[_ngcontent-%COMP%]{--background:var(--ion-color-light)}ion-grid[_ngcontent-%COMP%]{background:#fff}.item-input[_ngcontent-%COMP%]{--border-color:var(--ion-color-medium);--border-style:solid;--border-width:1px!important}@media (max-width:991px){ion-grid[_ngcontent-%COMP%], ion-grid[_ngcontent-%COMP%] > ion-row[_ngcontent-%COMP%] > ion-col[_ngcontent-%COMP%]{padding:0!important}}"]}),t})();var Z=n("d2mR"),tt=n("CP0t"),it=n("5iJv"),nt=n("b8Qw");let et=(()=>{class t{}return t.\u0275mod=C.Nb({type:t}),t.\u0275inj=C.Mb({factory:function(i){return new(i||t)},imports:[[e.i.forChild([{path:"",component:J}]),Z.a,s.e,s.l,tt.a,it.a,nt.a]]}),t})()}}]);